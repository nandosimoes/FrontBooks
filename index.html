<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css">
  <title>Biblioteca Digital</title>
</head>

<body>

  <div class="forms">
    <form action="">
      <h1>Buscar Livro</h1>
      <input id="title" type="text" placeholder="Título do Livro" />
      <h1>Idioma</h1>
      <input id="lan" type="text" placeholder="Idioma" />
      <button id="btn">Buscar</button>
    </form>
  </div>

  <div class="divPai">
    <!-- Os cards serão adicionados aqui -->
  </div>

  <div id="noResults" style="display: none; text-align: center; color: #ff0000;">
    <p>Nenhum livro encontrado.</p>
  </div>

</body>

<script>
const title = document.getElementById("title");
const languange = document.getElementById("lan");
const btn = document.getElementById("btn");
const divPai = document.querySelector('.divPai');
const noResults = document.getElementById('noResults');

btn.addEventListener("click", async (e) => {
  e.preventDefault();

  console.log(title.value, languange.value);

  // Construa a URL incluindo ambos os parâmetros
  const urlApi = `http://10.92.198.61:8080/user/testerAPI?title=${title.value}&language=${languange.value}`;
  
  try {
    const response = await fetch(urlApi, { method: "get" });
    const data = await response.json();

    console.log(data);

    const respostaAPI = data.respostaAPI;

    // Limpa os resultados antigos antes de exibir os novos
    divPai.innerHTML = '';

    if (respostaAPI && respostaAPI.length === 0) {
      noResults.style.display = 'block';
    } else {
      noResults.style.display = 'none';
      respostaAPI.forEach(book => {
        const card = document.createElement('div');
        card.classList.add('CardL');

        const img = document.createElement('img');
        img.classList.add('imagemCard');
        img.src = book.imagens?.thumbnail || 'https://portal.crea-sc.org.br/wp-content/uploads/2017/11/imagem-indisponivel-para-produtos-sem-imagem_15_5-450x450.jpg'; 
        img.alt = book.titulo;

        const h3 = document.createElement('h3');
        h3.textContent = book.titulo;

        const descricao = document.createElement('p');
        descricao.classList.add('descricao');
        descricao.textContent = book.descricao;

        const idioma = document.createElement('p');
        idioma.textContent = `Idioma: ${book.idioma}`;

        const autor = document.createElement('p');
        autor.textContent = `Autor: ${book.autor.join(', ')}`;

        const editora = document.createElement('p');
        editora.textContent = `Editora: ${book.editora}`;

        const verMaisButton = document.createElement('button');
        verMaisButton.textContent = 'Ver Mais';
        verMaisButton.classList.add('verMaisBtn');
        verMaisButton.onclick = () => {
          descricao.classList.toggle('expandido');
          verMaisButton.textContent = descricao.classList.contains('expandido') ? 'Ver Menos' : 'Ver Mais';
        };

        card.appendChild(img);
        card.appendChild(h3);
        card.appendChild(descricao);
        card.appendChild(idioma);
        card.appendChild(autor);
        card.appendChild(editora);
        card.appendChild(verMaisButton);

        divPai.appendChild(card);
      });
    }
  } catch (error) {
    console.error('Erro ao buscar os dados:', error);
    noResults.style.display = 'block'; 
    divPai.innerHTML = ''; 
  }
});
</script>

</html>
